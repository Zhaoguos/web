https://www.cnblogs.com/bethal/p/5806525.html （博客园linux详解）
http://mirrors.cn99.com/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-1708.iso CentOS镜像
wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.22-1.el7.x86_64.rpm-bundle.tar (mysql安装路径)
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo  yum源
rpm -e --nodeps  包名
yum -y localinstall *.rpm  解决本地rpm的依赖包
>/var/log/wtmp   清除历史用户登录信息 
>/var/run/utmp   清除当前登录用户信息
>/var/log/btmp    清除登录失败用户信息
/var/log/secure：记录登入系统存取数据的文件，例如 pop3, ssh, telnet, ftp 等都会被记录；
/var/log/wtmp：记录登入者的讯息数据，由于本文件已经被编码过，所以必须使用 last指令来取出文件的内容；
/var/log/messages：尤为重要，几乎发生的错误讯息（或是重要信息）都会被记录在此；
/var/log/boot.log：记录开机或者是一些服务启动的时候，所显示的启动或关闭讯息；
/var/log/maillog 或 /var/log/mail/*：纪录邮件存取或往来( sendmail 与 pop3 )的使用者记录；
/var/log/cron：记录 crontab 这个例行性服务的内容的。
主主环境（这里只介绍2台主的配置方案）:
1.CentOS 6.8 64位 2台：masterA（192.168.10.11），masterB（192.168.10.12）

2.官方Mysql5.6版本

搭建过程：
1.安装MySQL服务（建议源码安装）
1.1 yum安装依赖包
yum -y install make gcc gcc-c++  ncurses-devel bison openssl-devel
1.2 添加MySQL所需要的用户和组
groupadd -g 27 mysql
adduser -u 27 -g mysql -s /sbin/nologin mysql
1.3 下载MySQL源码包
mkdir -p /data/packages/src
cd /data/packages/
wget http://distfiles.macports.org/cmake/cmake-3.2.3.tar.gz
wget http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.34.tar.gz
1.4 创建mysql数据目录
mkdir -p /usr/local/mysql/data
1.5 解压编译安装cmake、MySQL
复制代码
cd /data/packages/src
tar -zxvf ../cmake-3.2.3.tar.gz
cd cmake-3.2.3/
./bootstrap
gmake
make install
cd ../
tar xf  mysql-5.6.34.tar.gz
cd mysql-5.6.34
cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DSYSCONFDIR=/etc \
-DWITH_SSL=bundled -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci \
-DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MYISAM_STORAGE_ENGINE=1 \
-DMYSQL_TCP_PORT=3306 -DMYSQL_UNIX_ADDR=/tmp/mysql.sock \
-DMYSQL_DATADIR=/usr/local/mysql/data
make && make install
复制代码
1.6 添加开机启动脚本
cp support-files/mysql.server /etc/rc.d/init.d/mysqld
1.7 添加masterA配置文件/etc/my.cnf
复制代码
[client]
port = 3306
socket = /tmp/mysql.sock

[mysqld]
basedir = /usr/local/mysql
port = 3306
socket = /tmp/mysql.sock
datadir = /usr/local/mysql/data
pid-file = /usr/local/mysql/data/mysql.pid
log-error = /usr/local/mysql/data/mysql.err

server-id = 1
auto_increment_offset = 1
auto_increment_increment = 2                                            #奇数ID

log-bin = mysql-bin                                                     #打开二进制功能,MASTER主服务器必须打开此项
binlog-format=ROW
binlog-row-p_w_picpath=minimal
log-slave-updates=true
gtid-mode=on
enforce-gtid-consistency=true
master-info-repository=TABLE
relay-log-info-repository=TABLE
sync-master-info=1
slave-parallel-workers=0
sync_binlog=0
binlog-checksum=CRC32
master-verify-checksum=1
slave-sql-verify-checksum=1
binlog-rows-query-log_events=1
#expire_logs_days=5
max_binlog_size=1024M                                                   #binlog单文件最大值

replicate-ignore-db = mysql                                             #忽略不同步主从的数据库
replicate-ignore-db = information_schema
replicate-ignore-db = performance_schema
replicate-ignore-db = test
replicate-ignore-db = zabbix

max_connections = 3000
max_connect_errors = 30

skip-character-set-client-handshake                                     #忽略应用程序想要设置的其他字符集
init-connect='SET NAMES utf8'                                           #连接时执行的SQL
character-set-server=utf8                                               #服务端默认字符集
wait_timeout=1800                                                       #请求的最大连接时间
interactive_timeout=1800                                                #和上一参数同时修改才会生效
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES                     #sql模式
max_allowed_packet = 10M
bulk_insert_buffer_size = 8M
query_cache_type = 1
query_cache_size = 128M
query_cache_limit = 4M
key_buffer_size = 256M
read_buffer_size = 16K

skip-name-resolve
slow_query_log=1
long_query_time = 6
slow_query_log_file=slow-query.log
innodb_flush_log_at_trx_commit = 2
innodb_log_buffer_size = 16M

[mysql]
no-auto-rehash

[myisamchk]
key_buffer_size = 20M
sort_buffer_size = 20M
read_buffer = 2M
write_buffer = 2M

[mysqlhotcopy]
interactive-timeout

[mysqldump]
quick
max_allowed_packet = 16M

[mysqld_safe]
复制代码
1.8 特别参数说明
log-slave-updates = true     #将复制事件写入binlog,一台服务器既做主库又做从库此选项必须要开启
#masterA自增长ID
auto_increment_offset = 1
auto_increment_increment = 2                                            #奇数ID
#masterB自增加ID
auto_increment_offset = 2
auto_increment_increment = 2                                            #偶数ID
1.9 添加masterB配置文件/etc/my.cnf
复制代码
[client]
port = 3306
socket = /tmp/mysql.sock

[mysqld]
basedir = /usr/local/mysql
port = 3306
socket = /tmp/mysql.sock
datadir = /usr/local/mysql/data
pid-file = /usr/local/mysql/data/mysql.pid
log-error = /usr/local/mysql/data/mysql.err

server-id = 2
auto_increment_offset = 2
auto_increment_increment = 2                                            #偶数ID

log-bin = mysql-bin                                                     #打开二进制功能,MASTER主服务器必须打开此项
binlog-format=ROW
binlog-row-p_w_picpath=minimal
log-slave-updates=true
gtid-mode=on
enforce-gtid-consistency=true
master-info-repository=TABLE
relay-log-info-repository=TABLE
sync-master-info=1
slave-parallel-workers=0
sync_binlog=0
binlog-checksum=CRC32
master-verify-checksum=1
slave-sql-verify-checksum=1
binlog-rows-query-log_events=1
#expire_logs_days=5
max_binlog_size=1024M                                                   #binlog单文件最大值

replicate-ignore-db = mysql                                             #忽略不同步主从的数据库
replicate-ignore-db = information_schema
replicate-ignore-db = performance_schema
replicate-ignore-db = test
replicate-ignore-db = zabbix

max_connections = 3000
max_connect_errors = 30

skip-character-set-client-handshake                                     #忽略应用程序想要设置的其他字符集
init-connect='SET NAMES utf8'                                           #连接时执行的SQL
character-set-server=utf8                                               #服务端默认字符集
wait_timeout=1800                                                       #请求的最大连接时间
interactive_timeout=1800                                                #和上一参数同时修改才会生效
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES                     #sql模式
max_allowed_packet = 10M
bulk_insert_buffer_size = 8M
query_cache_type = 1
query_cache_size = 128M
query_cache_limit = 4M
key_buffer_size = 256M
read_buffer_size = 16K

skip-name-resolve
slow_query_log=1
long_query_time = 6
slow_query_log_file=slow-query.log
innodb_flush_log_at_trx_commit = 2
innodb_log_buffer_size = 16M

[mysql]
no-auto-rehash

[myisamchk]
key_buffer_size = 20M
sort_buffer_size = 20M
read_buffer = 2M
write_buffer = 2M

[mysqlhotcopy]
interactive-timeout

[mysqldump]
quick
max_allowed_packet = 16M

[mysqld_safe]
复制代码
1.10 初始化MySQL
cd /usr/local/mysql
scripts/mysql_install_db --user=mysql
1.11 为启动脚本赋予可执行权限并启动MySQL
chmod +x /etc/rc.d/init.d/mysqld
/etc/init.d/mysqld start
2. 配置主从同步
2.1 添加主从同步账户
masterA上：

mysql> grant replication slave on *.* to 'repl'@'192.168.10.12' identified by '123456';
mysql> flush privileges;
masterB上：

mysql> grant replication slave on *.* to 'repl'@'192.168.10.11' identified by '123456';
mysql> flush privileges;
2.2 查看主库的状态
masterA上：

复制代码
mysql> show master status;

+------------------+----------+--------------+------------------+-------------------+

| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |

+------------------+----------+--------------+------------------+-------------------+

| mysql-bin.000003 |      120 |              |                  |                   |

+------------------+----------+--------------+------------------+-------------------+

1 row in set (0.00 sec)
复制代码
masterB上

复制代码
mysql> show master status;

+------------------+----------+--------------+------------------+-------------------+

| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |

+------------------+----------+--------------+------------------+-------------------+

| mysql-bin.000003 |      437 |              |                  |                   |

+------------------+----------+--------------+------------------+-------------------+

1 row in set (0.00 sec)
复制代码
2.3 配置同步信息：
masterA上：

mysql> change master to master_host='192.168.10.12',master_port=3306,master_user='repl',master_password='123456',master_log_file='mysql-bin.000003',master_log_pos=437;

mysql> start slave;

mysql> show slave status\G;
 

显示有如下状态则正常：

Slave_IO_Running: Yes

Slave_SQL_Running: Yes
masterB上：

#本人是测试环境，可以保证没数据写入，否则需要的步骤是：先masterA锁表-->masterA备份数据-->masterA解锁表 -->masterB导入数据-->masterB设置主从-->查看主从

mysql> change master to master_host='192.168.10.11',master_port=3306,master_user='repl',master_password='123456',master_log_file='mysql-bin.000003',master_log_pos=120;

start slave;

mysql> show slave status\G;
显示有如下状态则正常：

Slave_IO_Running: Yes

Slave_SQL_Running: Yes
3.测试主从同步
3.1 在masterA上创建一个数据库测试同步效果
复制代码
mysql> show databases;

+--------------------+

| Database           |

+--------------------+

| information_schema |

| mysql              |

| performance_schema |

| test               |

+--------------------+

4 rows in set (0.00 sec)

mysql> create database test01;

Query OK, 1 row affected (0.00 sec)

mysql> show databases;

+--------------------+

| Database           |

+--------------------+

| information_schema |

| mysql              |

| performance_schema |

| test               |

| test01             |

+--------------------+

5 rows in set (0.00 sec)

mysql> quit

Bye

[root@masterA data]#
复制代码
3.2 到masterB查看是否已经同步创建数据库
复制代码
mysql> show databases;

+--------------------+

| Database           |

+--------------------+

| information_schema |

| mysql              |

| performance_schema |

| test               |

| test01             |

+--------------------+

5 rows in set (0.00 sec)

mysql> quit

Bye

[root@masterB data]#
复制代码
4. 开启MySQL5.6的GTID功能
masterA和masterB分别执行如下命令：

复制代码
mysql> stop slave;

Query OK, 0 rows affected (0.00 sec)

mysql> change master to MASTER_AUTO_POSITION=1;

Query OK, 0 rows affected (0.01 sec)

mysql> start slave;

Query OK, 0 rows affected (0.00 sec)

按照系统更新yum源，我的是centos7，所以我运行下面的代码！
CentOS/RHEL 7.x:yum -y install epel-release(安装epel源）

1、rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
2、rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
3、yum -y install php70w 
如果是centos6，那么执行以下代码： 
CentOS/RHEL 6.x:

1、rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm
2、rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm
然后就可以直接yum安装php7.0了，可以安装的拓展如下：
yum install php70w-common php70w-fpm php70w-opcache php70w-gd php70w-mysqlnd php70w-mbstring php70w-pecl-redis php70w-pecl-memcached php70w-devel
就这一条命令，就可以安装了下面的拓展了！
php-api, php-bz2, php-calendar, php-ctype, php-curl, php-date, php-exif, php-fileinfo, php-filter, php-ftp, php-gettext, php-gmp, php-hash, php-iconv, php-json, php-libxml, php-openssl, php-pcre, php-pecl-Fileinfo, php-pecl-phar, php-pecl-zip, php-reflection, php-session, php-shmop, php-simplexml, php-sockets, php-spl, php-tokenizer, php-zend-abi, php-zip, php-zlib
 
CentOS防火墙在虚拟机的CENTOS装好APACHE不能用,郁闷,解决方法如下 
 
/sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT 
/sbin/iptables -I INPUT -p tcp --dport 22 -j ACCEPT 

/sbin/iptables -F
/sbin/iptables -P INPUT DROP
/sbin/iptables -P OUTPUT ACCEPT
/sbin/iptables -P FORWARD ACCEPT

/sbin/iptables -A INPUT -m state --state INVALID -j LOG --log-level 4 --log-prefix 'InvalidDrop '
/sbin/iptables -A INPUT -m state --state INVALID -j DROP
/sbin/iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
/sbin/iptables -A INPUT -j LOG --log-level 4 --log-prefix 'In'
/sbin/iptables -A OUTPUT -m limit -j LOG --log-level 4 --log-prefix 'Out'

/sbin/iptables -A INPUT -i lo -j ACCEPT
/sbin/iptables -A INPUT -s 127.0.0.1 -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 21  -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 22  -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 25  -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 53  -j ACCEPT
/sbin/iptables -A INPUT -p tcp --dport 110:65534  -j ACCEPT
/sbin/iptables -A INPUT -p udp --dport 21:65534  -j ACCEPT

/sbin/iptables -A INPUT -i eth1 -p tcp -s 58.83.238.20 --dport 80 -j ACCEPT
/sbin/iptables -A INPUT -i eth1 -p tcp -s 58.83.238.21 --dport 80 -j ACCEPT
/sbin/iptables -A INPUT -i eth1 -p tcp -s 219.142.118.0/24 --dport 80 -j ACCEPT
/sbin/iptables -A INPUT -i eth1 -p tcp -s 10.0.0.0/8 --dport 80 -j ACCEPT
还原为iptables 
systemctl stop firewalld
systemctl mask firewalld
yum install iptables-services
systemctl enable iptables
systemctl stop iptables
systemctl start iptables
systemctl restart iptables 
systemctl reload iptables
mysql查询报错1055解决办法
sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'
APACHE下多个域名绑定到一个目录下 如何设置
例：比如域名分别为www.site1.com;site1.com;www.site1.cn
<VirtualHost 202.100.1.1>
ServerName www.site1.cn
ServerAlias site1.com
ServerAlias www.site1.com
DocumentRoot "D:/PC_webserver/phproot/site"
</VirtualHost>
http强制跳转https
RewriteEngine on
RewriteCond  %{HTTPS} !=on
RewriteRule  ^(.*) https://%{SERVER_NAME}$1 [L,R]
安装vsftpd：
	1、yum install vsftpd
		确保防火墙关闭了
	2、配置文件/etc/vsftpd/vsftpd.conf
		注意：所有语句必须顶格写，否则语法错误
		local_enable:是否启用系统用户
		write_enable:定义系统用户是否能上传文件
		anon_upload_enable:是否允许匿名用户上传文件
			setfacl -m u:ftp:rwx /var/ftp/upload 同时要给ftp可写权限后，才能上传
		chroot_list_enable：是否把用户禁锢在其家目录下，要和下面的一条配合使用
		chroot_list_file：具体要禁锢的用户，指定文件，并在文件中添加用户：
			hadoop
			tom
		如果想直接禁锢所有用户，则把上面2条注释掉，只需增加一条即可：
			chroot_local_user=YES
		userlist_enable:启用userlist文件来控制用户登录，再配合userlist_deny使用	
	3、测试...
		可以用windows终端测试，还可以用web测试

apache配置php环境
编辑 /usr/local/apache2/conf/httpd.conf 文件时要注意：         

找到：    
AddType  application/x-compress .Z    
AddType application/x-gzip .gz .tgz    
在后面添加：    
AddType application/x-httpd-php .php（使Apcche支持PHP）    
AddType application/x-httpd-php-source .php5       

找到：    <IfModule dir_module>    DirectoryIndex index.html    </IfModule>    
添加：    <IfModule dir_module>    DirectoryIndex index.html index.php    </IfModule>        

找到：    ＃ServerName www.example.com:80    
修改为：  ServerName 127.0.0.1:80或者ServerName localhost:80    记得要去掉前面的“＃”  


修改默认的Web站点目录

找到：DocumentRoot "/usr/local/apache2/htdocs"
修改为：DocumentRoot "/home/www/WebSite" --该目录为自己创建的目录
数据库数据的导入和导出
mysql -uroot -p yii2 </var/lib/mysql/yii2/play_method.sql （向指定表导入数据）
mysqldump -uroot  -p yii2 > /var/lib/mysql/yii2/yii2.sql  (导出数据库)
mysqldump -uroot  -p yii2 user >/var/lib/mysql/yii2/user.sql(导出指定表数据)
一. 表的导入

1.进入数据库

mysql 数据库名

2.?查看表

show tables;?

3.导入表

?mysql -u root 数据库名 <　表名

mysql -uroot -p database < fileName.sql
1
注意：fileName.sql最好加上路径?
1
2
二. 表的导出??

  1）导出整个数据库：
1
2
mysqldump -u userName -p  dabaseName  > fileName.sql
1
注意：fileName.sql最好加上路径名

2）导出数据库中所有表的结构
1
2
mysqldump -u userName -p -d dabaseName  > fileName.sql
1
注意：加上了-d

3）导出数据库中某个表
1
2
mysqldump -u userName -p  dabaseName tableName > fileName.sql 
1
4）导出数据库中某个表的表结构
1
2
mysqldump -u userName -p -d dabaseName tableName > fileName.sql
iptables配置说明：
           iptables 有4表5链 
              4表有：
                     filter：        功能对进出服务器数据包的过滤，和通过服务器做数据转发做过滤
                     nat：          功能主要用于做内外网地址转换数据转发
                     mangle：  用的不多，不做叙说
                     raw：         用的不多，不做叙说
             5链有：
                    prerouting：    指定路由前的规则
                    input ：             指定入口时的规则
                    forward：          指定转发时的规则
                    ouput：             指定出口的规则
                    postrouting：  指定路由后的规则
          
         iptables的配置命令介绍
https://blog.csdn.net/qq_23595257/article/details/80500203（iptables的设置）
                    iptables [-t table] {-A|-C|-D} chain rule-specification    
                             -t ：指明对哪张表进行操作 系统默认是对filter表
                             -A：在表的最后一行插入一个规则
                             -C：检查规则是否存在
                             -D：删除规则

                   iptables -A INPUT -d 192.168.1.100 -s 172.16.1.0/24 -j ACCEPT
                      在filter表的INPUT链中最后一行增加一个规则：允许172.16.1.0这个网段访问服务器的192.168.1.100 这个地址
                   iptables -A INPUT -d -d 192.168.1.100  -p tcp --dport 80 -j ACCEPT
                      在filter表的INPUT链中最后一行增加一个规则：允许任何主机访问服务器的192.168.1.100 的80端口
                   iptables -D INPUT 3
                       删除filter表INPUT链中的第三条记录

                    iptables [-t table] -I chain [rulenum] rule-specification
                            -I (大写的i) ：在[rulenum]前面插入一条规则
                         
                   iptables  -I INPUT 3 -i lo -j ACCEPT
                       在filter表INPUT链第三行规则前面插入允许本机lo环口通过 （服务器ping/ssh/telent自己，以及系统内部自己socket调用都是通过lo环口，该端口配置防火墙时一定要开启） 
                   
                  iptables [-t table] -P chain target
                             -P ：指定链的默认行为
    
                  iptables -P INPUT DORP
                       指定filter表INPUT链默认行为：DROP
                  
                  iptables [-t table] {-F|-Z|-X} [chain [rulenum]] [options...]
                       -F：将iptables规则清除
                       -Z：将iptables规则匹配或拒绝的数据包、字节数清零
                       -X：删除用户自定的链（该链中规则必须先清除）
                  
                 通常清空防火墙配置的三步曲：
                       iptables -F 
                       iptables -Z
                       iptables -X  
         
                iptables -L -n -v   ：常看当前iptables的配置
 linux系统优化等
 https://www.cnblogs.com/chenchenphp/p/6616792.html
 Linux系统基础优化14条总结
 https://blog.csdn.net/codeTZ/article/details/52277980
 Linux CentOS 6.9系统优化脚本
 http://blog.51cto.com/ygtq666/2060903
 centos7 修改中文字符集
 https://blog.csdn.net/halley333/article/details/51783228
 25个iptables常用示例
本文将给出25个iptables常用规则示例，这些例子为您提供了些基本的模板，您可以根据特定需求对其进行修改调整以达到期望。  格式

iptables [-t 表名] 选项 [链名] [条件] [-j 控制类型] 参数

 
-P 设置默认策略:iptables -P INPUT (DROP|ACCEPT)
-F 清空规则链
-L 查看规则链
-A 在规则链的末尾加入新规则
-I num 在规则链的头部加入新规则
-D num 删除某一条规则
-s 匹配来源地址IP/MASK，加叹号"!"表示除这个IP外。
-d 匹配目标地址
-i 网卡名称 匹配从这块网卡流入的数据
-o 网卡名称 匹配从这块网卡流出的数据
-p 匹配协议,如tcp,udp,icmp
--dport num 匹配目标端口号
--sport num 匹配来源端口号
示例

1. 删除已有规则
在开始创建iptables规则之前，你也许需要删除已有规则。

 
命令如下：
iptables -F
(or)
iptables Cflush
2.设置链的默认策略
链的默认政策设置为”ACCEPT”（接受），若要将INPUT,FORWARD,OUTPUT链设置成”DROP”（拒绝），命令如下：

 
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
当INPUT链和OUTPUT链都设置成DROP时，对于每一个防火墙规则，我们都应该定义两个规则。例如：一个传入另一个传出。在下面所有的例子中，由于我们已将DROP设置成INPUT链和OUTPUT链的默认策略，每种情况我们都将制定两条规则。当然，如果你相信你的内部用户,则可以省略上面的最后一行。例如：默认不丢弃所有出站的数据包。在这种情况下,对于每一个防火墙规则要求,你只需要制定一个规则――只对进站的数据包制定规则。

3. 阻止指定IP地址
例：丢弃来自IP地址x.x.x.x的包

 
iptables -A INPUT -s x.x.x.x -j DROP
注：当你在log里发现来自某ip地址的异常记录，可以通过此命令暂时阻止该地址的访问以做更深入分析
例：阻止来自IP地址x.x.x.x eth0 tcp的包

 
iptables -A INPUT -i eth0 -s x.x.x.x -j DROP
iptables -A INPUT -i eth0 -p tcp -s x.x.x.x -j DROP
4. 允许所有SSH的连接请求
例：允许所有来自外部的SSH连接请求，即只允许进入eth0接口，并且目标端口为22的数据包

 
iptables -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
5. 仅允许来自指定网络的SSH连接请求
例：仅允许来自于192.168.100.0/24域的用户的ssh连接请求

 
iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
6.允许http和https的连接请求
例：允许所有来自web - http的连接请求

 
iptables -A INPUT -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT
例：允许所有来自web - https的连接请求

 
iptables -A INPUT -i eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT
7. 使用multiport 将多个规则结合在一起
允许多个端口从外界连入，除了为每个端口都写一条独立的规则外，我们可以用multiport将其组合成一条规则。如下所示：  例：允许所有ssh,http,https的流量访问

 
iptables -A INPUT -i eth0 -p tcp -m multiport --dports 22,80,443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp -m multiport --sports 22,80,443 -m state --state ESTABLISHED -j ACCEPT
8. 允许从本地发起的SSH
 
iptables -A OUTPUT -o eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
请注意,这与允许ssh连入的规则略有不同。本例在OUTPUT链上，我们允许NEW和ESTABLISHED状态。在INPUT链上，我们只允许ESTABLISHED状态。ssh连入的规则与之相反。

9. 仅允许从本地发起到一个指定的网络域的SSH请求
例：仅允许从内部连接到网域192.168.100.0/24

 
iptables -A OUTPUT -o eth0 -p tcp -d 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
10. 允许从本地发起的HTTPS连接请求
下面的规则允许输出安全的网络流量。如果你想允许用户访问互联网，这是非常有必要的。在服务器上，这些规则能让你使用wget从外部下载一些文件

 
iptables -A OUTPUT -o eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT
注：对于HTTP web流量的外联请求，只需要将上述命令中的端口从443改成80即可。

11. 负载平衡传入的网络流量
使用iptables可以实现传入web流量的负载均衡，我们可以传入web流量负载平衡使用iptables防火墙规则。  例：使用iptables nth将HTTPS流量负载平衡至三个不同的ip地址。

 
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 1 -j DNAT --to-destination 192.168.1.102:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 2 -j DNAT --to-destination 192.168.1.103:443
12. 允许外部主机ping内部主机
 
iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT
13. 允许内部主机ping外部主机
 
iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT
14. 允许回环访问
例：在服务器上允许127.0.0.1回环访问。

 
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
15. 允许内部网络域外部网络的通信
防火墙服务器上的其中一个网卡连接到外部，另一个网卡连接到内部服务器，使用以下规则允许内部网络与外部网络的通信。此例中，eth1连接到外部网络(互联网)，eth0连接到内部网络(例如:192.168.1.x)。

 
iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT
16. 允许出站的DNS连接
 
iptables -A OUTPUT -p udp -o eth0 --dport 53 -j ACCEPT
iptables -A INPUT -p udp -i eth0 --sport 53 -j ACCEPT
17. 允许NIS连接
如果你使用NIS管理用户帐户，你需要允许NIS连接。如果你不允许NIS相关的ypbind连接请求，即使SSH连接请求已被允许，用户仍然无法登录。NIS的端口是动态的，先使用命令rpcinfo Cp来知道端口号，此例中为853和850端口。  rpcinfo -p | grep ypbind  例：允许来自111端口以及ypbind使用端口的连接请求

 
iptables -A INPUT -p tcp --dport 111 -j ACCEPT
iptables -A INPUT -p udp --dport 111 -j ACCEPT
iptables -A INPUT -p tcp --dport 853 -j ACCEPT
iptables -A INPUT -p udp --dport 853 -j ACCEPT
iptables -A INPUT -p tcp --dport 850 -j ACCEPT
iptables -A INPUT -p udp --dport 850 -j ACCEPT
注：当你重启ypbind之后端口将不同，上述命令将无效。有两种解决方案：1）使用你NIS的静态IP 2）编写shell脚本通过“rpcinfo - p”命令自动获取动态端口号,并在上述iptables规则中使用。

18. 允许来自指定网络的rsync连接请求
例：允许来自网络192.168.101.0/24的rsync连接请求

 
iptables -A INPUT -i eth0 -p tcp -s 192.168.101.0/24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT
19. 允许来自指定网络的MySQL连接请求
很多情况下，MySQL数据库与web服务跑在同一台服务器上。有时候我们仅希望DBA和开发人员从内部网络（192.168.100.0/24）直接登录数据库，可尝试以下命令：

 
iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 3306 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 3306 -m state --state ESTABLISHED -j ACCEPT
20. 允许Sendmail, Postfix邮件服务
Sendmail和postfix都使用了25端口，因此我们只需要允许来自25端口的连接请求即可。

 
iptables -A INPUT -i eth0 -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT
21. 允许IMAP和IMAPS
例：允许IMAP/IMAP2流量，端口为143

 
iptables -A INPUT -i eth0 -p tcp --dport 143 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 143 -m state --state ESTABLISHED -j ACCEPT
例：允许IMAPS流量，端口为993

 
iptables -A INPUT -i eth0 -p tcp --dport 993 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 993 -m state --state ESTABLISHED -j ACCEPT
22. 允许POP3和POP3S
例：允许POP3访问

 
iptables -A INPUT -i eth0 -p tcp --dport 110 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 110 -m state --state ESTABLISHED -j ACCEPT
例：允许POP3S访问

 
iptables -A INPUT -i eth0 -p tcp --dport 995 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 995 -m state --state ESTABLISHED -j ACCEPT
23. 防止DoS攻击

iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT
上述例子中：
-m limit: 启用limit扩展
Climit 25/minute: 允许最多每分钟25个连接（根据需求更改）。
Climit-burst 100: 只有当连接达到limit-burst水平(此例为100)时才启用上述limit/minute限制。
24. 端口转发
例：将来自422端口的流量全部转到22端口。  这意味着我们既能通过422端口又能通过22端口进行ssh连接。启用DNAT转发。
iptables -t nat -A PREROUTING -p tcp -d 192.168.102.37 --dport 422 -j DNAT --to 192.168.102.37:22
除此之外，还需要允许连接到422端口的请求
iptables -A INPUT -i eth0 -p tcp --dport 422 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 422 -m state --state ESTABLISHED -j ACCEPT
25. 记录丢弃的数据表
第一步：新建名为LOGGING的链
iptables -N LOGGING
第二步：将所有来自INPUT链中的数据包跳转到LOGGING链中
iptables -A INPUT -j LOGGING
第三步：为这些包自定义个前缀，命名为”IPTables Packet Dropped”
iptables -A LOGGING -m limit --limit 2/min -j LOG --log-prefix "IPTables Packet Dropped: " --log-level 7
第四步：丢弃这些数据包
iptables -A LOGGING -j DROP